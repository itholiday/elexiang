<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no" />
		<title>e乐享</title>
		<link rel="stylesheet" type="text/css" href="../css/aui.css" />

		<style>
			body{
				background: #fff;
			}
			.aui-bar-nav,.aui-searchbar{
				background: #fff;
				color: #333;
			}
			.aui-bar-nav .aui-btn .aui-iconfont{
				color: #333;
			}
			#textHtml .aui-col-xs-6{
				padding: 0.4rem 0.75rem
			}
			.aui-searchbar-input{
				background: #F2F2F2
			}
			.aui-btn-sm {
				margin: 0.35rem;
				font-size: 0.65rem;
				border-radius: 2rem;
			}
			#wujil{
				text-align: center;
				padding: 2rem;
				width: 100%;
				color: #ccc;
				font-size: 0.65rem;
			}
		</style>
	</head>
	<body>
		<header class="aui-bar aui-bar-nav" style="border-bottom: 1px solid #e8e8e8;" id="sx-header">
	        <a class="aui-pull-left aui-btn">
	            <span class="aui-iconfont aui-icon-left" tapmode onclick="_close()"></span>
	        </a>
	        <div class="aui-title" style="left:2rem; right: 0.5rem;">
	            <div class="aui-searchbar" id="search">
	                <div class="aui-searchbar-input aui-border-radius">
	                	<form>
	                    <input type="search" placeholder="请输入搜索内容" id="input">
	                    </form>
	                </div>
	            </div>
	        </div>
	    </header>

		<div style="padding: 0.75rem;" id="htmls">
			<div id="wujil">暂无记录</div>
		</div>
		<div style="width: 30%;margin: 0 auto;display: none" id="qingkoas"><div style="font-size: 0.6rem;" class="aui-btn-block aui-btn-outlined aui-btn-sm aui-btn " tapmode onclick="del()"><span class="aui-iconfont aui-icon-trash"></span>清空记录</div></div>
	</body>
	<script type="text/javascript" src="../script/fastclick.js"></script>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/app.js"></script>
	<script type="text/javascript" src="../script/zepto.min.js"></script>
	<script type="text/javascript">
		apiready = function() {
			_heibai(1);
			var header = $api.byId('sx-header');
			$api.fixStatusBar(header);
			FastClick.attach(document.body)
			setTimeout(function(){
				$('#input').focus()
			},300)
			var searchText = $api.getStorage('searchText');
				if (searchText) {
					$('#qingkoas').show();
					$('#wujil').hide();
					var textHtml = "";
					if (searchText.indexOf(",") > 0) {
						var strs = new Array();
						strs = searchText.split(",");
						for (var i = 0; i < strs.length; i++) {
							textHtml += '<div class="aui-btn aui-btn-outlined aui-btn-sm " tapmode onclick=\'key("'+strs[i]+'")\'>'+strs[i]+'</div>';
						}
					} else {
						textHtml += '<div class="aui-btn aui-btn-outlined aui-btn-sm " tapmode onclick=\'key("'+searchText+'")\'>'+searchText+'</div>';
					}
					$('#htmls').html(textHtml);
				}

			// 回车搜索
			window.onkeydown = function(e) {
				//_msg(e.keyCode)
				if (e.keyCode == 13) {
					var q = $api.val($api.byId('input'));
					if (q) {
						var text = $('#input').val();
						$('#htmls').prepend('<div class="aui-btn aui-btn-outlined aui-btn-sm " tapmode onclick=\'key("'+text+'")\'>'+text+'</div>');

						key(text)
					}
					return false;
				}
			}
			//应用进入后台事件
			api.addEventListener({
			    name:'pause'
			}, function(ret, err){
				time = Date.parse(new Date());
				time=time+60000
				$api.setStorage('time',time);
			});
			// 应用从后台回到前台事件
			api.addEventListener({
			    name:'resume'
			}, function(ret, err){
			    time = Date.parse(new Date());
			    if($api.getStorage('time')){
			    	if(time > $api.getStorage('time')){
				    	_hone()
				    }
			    }
			});
		}
		// 点击关键词搜索
		function key(text) {
			if (!text) {
				_msg('请输入搜索关键词')
				return;
			}
			$('#qingkoas').show();
			$('#wujil').hide();

			$("#input").blur();
			var searchText = $api.getStorage('searchText');
			if (searchText == undefined) {
				$api.setStorage('searchText', text);
			} else {
				//判断关键词是否存在
				var Cts = searchText.indexOf(text);
				if (Cts == -1) {
					searchText = text + ',' + searchText
					$api.setStorage('searchText', searchText);
				}
			}
			_url({s:1,title:'搜索<b>'+text+'</b>商品',url:'zhuanqu',text:text})
		}
		// 清空记录
		function del() {
			$('#htmls').html('<div id="wujil">暂无记录</div>');
			$('#qingkoas').hide()
			$('#wujil').show();
			$api.rmStorage('searchText');
			_msg('清空成功')
		}
	</script>
</html>
