<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no" />
	<title>e乐享</title>
	<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
	<style>
		.aui-content {
			background: #fff;
			box-shadow: 0px 0px 5px 2px #ccc;
		}

		.aui-content p {
			margin: 0.15rem 0.85rem;
			font-size: 0.65rem;
		}

		.aui-list .aui-list-item-title {
			font-size: 0.75rem;
		}

		.aui-list .aui-list-item i.aui-iconfont {}

		.asdasd {
			color: #FF2D4B !important;
		}

		.aui-list {
			background: #FFF;
			border: 0px;
		}

		.aui-label {
			display: inline;
			font-size: 0.55rem;
			padding: 0.25rem 0.45rem;
		}

		.aui-btn-block {
			height: 2rem;
			line-height: 2rem;
		}

		#add {
			width: 100%;
			position: fixed;
			bottom: 0px;
			margin: 0 auto
		}

		#add div {
			border-radius: 0px;
		}

		#sx-view {
			padding-bottom: 40px;
			margin-bottom: 40px;
		}
	</style>
</head>

<body>
	<script id="sx-list" type="text/x-dot-template">
		{{ for(var i=0,len=it.data.length; i
		< len; i++) { }} <div class="aui-content aui-margin-15 aui-padded-b-5">
			<ul class="aui-list aui-list-in">
				<li class="aui-list-item">
					<div class="aui-list-item-inner">
						<div class="aui-list-item-title {{? it.data[i].default=='Y' }}asdasd{{?}}">
							<i class="aui-iconfont aui-icon-location {{? it.data[i].default=='Y'}}asdasd{{?}}"></i> 收货地址  {{? it.data[i].default=='Y'}}
							<span class="aui-label aui-label-info aui-margin-l-10">默认</span> {{?}}
						</div>
						<div class="aui-list-item-right" tapmode data-data='{{= JSON.stringify(it.data[i]) }}' onclick="xiugai(this)">
							修改
						</div>
						<div class="aui-list-item-right" tapmode data-data='{{= it.data[i].id }}' onclick="deletes(this)">
							删除
						</div>
					</div>
				</li>
				<div {{? index}}data-data='{{= JSON.stringify(it.data[i]) }}' tapmode onclick="moren(this)" {{?}}>
					<p>收货姓名：{{= it.data[i].shouhuoren}}</p>
					<p>手机号码：{{= it.data[i].mobile}}</p>
					<p>详细地址 ：{{= (it.data[i].sheng==it.data[i].shi?'':it.data[i].sheng)}}{{= it.data[i].shi}}{{= it.data[i].xian}}{{= it.data[i].jiedao}}</p>
				</div>
			</ul>
			</div>
			{{ } }}
	</script>
	<div id="sx-view">
		<div id="jiazai"><img src="../../image/loading_more.gif" /></div>
	</div>
	<div id="add">
		<div class="aui-btn-block aui-btn aui-btn-info" tapmode onclick="_url({url:'user/dizhiAdd',title:'添加新地址'})">添加新地址</div>
	</div>
</body>
<script type="text/javascript" src="../../script/zepto.min.js"></script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/doT.js"></script>
<script type="text/javascript" src="../../script/app.js"></script>
<script type="text/javascript">
	var likai = 0,
		index = 0;
	apiready = function() {
		$api.fixTabBar($api.byId('add'))
		index = api.pageParam['index'];
        _lists({
            url: 'user/get_address_list',
            page: 1,
            loading: 1
        });
		// 下拉刷新
		_shangla(function(ret, err) {
				_lists({
					url: 'user/get_address_list',
					page: 1,
					loading: 1
				});
			},1)
			// 监听滚动
		api.addEventListener({
			name: 'scrolltobottom',
			extra: {
				threshold: threshold //设置距离底部多少距离时触发，默认值为0，数字类型
			}
		}, function(ret, err) {
			if (heigutgao == 1) { // heigutgao=1开启执行 0停止执行   防止连续滚动，等加载数据之后在进行滚动。
				pagenum += 1
				_lists({
					url: 'user/get_address_list',
					page: pagenum,
					token: true
				});
			}
		});
		// 回到屏幕
		api.addEventListener({
			name: 'viewappear'
		}, function(ret, err) {
            _lists({
                url: 'user/get_address_list',
                page: 1,
                loading: 1
            });
		});
		// 屏幕消失
		api.addEventListener({
			name: 'viewdisappear'
		}, function(ret, err) {
			likai = 1
		});
	}

	function xiugai(thiss) {
		var data = $api.attr(thiss, 'data-data');
		if (data) {
			data = eval('(' + data + ')');
			var json = {};
			var json1 = data;
			var json2 = {
				url: 'user/dizhiAdd',
				title: '修改地址'
			};
			json = eval('(' + (JSON.stringify(json1) + JSON.stringify(json2)).replace(/}{/, ',') + ')');
			data = json;
		}
		_url(data)
	}

	function deletes(thiss) {
		var data = $api.attr(thiss, 'data-data');
		data = {
			'address_id': data
		};

		_ajax('user/del_address', function(ret, err) {
			if (ret) {
				if (ret.status == 0) {
					_msg(ret.msg)
				} else {
					_msg(ret.msg)
				}
                api.refreshHeaderLoading();
			}
		}, data, true)
	}

	function moren(thiss) {
		var data = $api.attr(thiss, 'data-data');
		var index = api.pageParam['index'];
		var name = 'user/dingdanPay'
		if (index == 2) {
			name = 'mallPay'
		}

		api.execScript({
			name: name,
			frameName: name,
			script: 'dizhiss(' + data + ')'
		});
		_close()
	}
</script>

</html>
