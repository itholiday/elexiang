<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no" />
	<title>e乐享</title>
	<link rel="stylesheet" type="text/css" href="../css/aui.css" />
	<link rel="stylesheet" type="text/css" href="../css/login.css" />
</head>

<body>
	<div class="aui-content aui-margin-b-15 fx-yejian-by" style="padding-top: 50px;">
		<ul class="aui-list aui-form-list" id="login-1">
			<li class="aui-list-item" id="mobile">
				<div class="aui-list-item-inner">
					<div class="aui-list-item-input">
						<input type="tel" placeholder="输入手机" value="">
					</div>
				</div>
			</li>
			<li class="aui-list-item" id="password">
				<div class="aui-list-item-inner">
					<div class="aui-list-item-input">
						<input type="password" placeholder="设置新密码" value="">
					</div>
				</div>
			</li>
			<li class="aui-list-item" id="yzm">
				<div class="aui-list-item-inner">
					<div class="aui-list-item-input">
						<input type="tel" placeholder="输入验证码" value="">
					</div>
					<div class="aui-list-item-label-icon fx-yzm" id="sendVerify" status="1">
						获取验证码
					</div>
				</div>
			</li>
		</ul>
	</div>
	<div class="aui-content aui-margin-b-15 fx-login fx-yejian-by">
		<div class="aui-btn aui-btn-danger aui-btn-block aui-btn-sm" id="tijiao">
			提交
		</div>
	</div>
</body>
<script type="text/javascript" src="../script/zepto.min.js"></script>
<script type="text/javascript" src="../script/fastclick.js"></script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/app.js"></script>
<script type="text/javascript">
	apiready = function() {
		FastClick.attach(document.body);
		$('#tijiao').click(function() {
			var username = $('#mobile input').val();
			var password = $('#password input').val();
			var code = $('#yzm input').val();
			if (!username) {
				_alert('手机号码不能空', function(ret, err) {
					$('#username').focus()
				})
				return;
			}
			if (!_isMobile(username)) {
				_alert('请输入正确手机号码', function(ret, err) {
					$('#username').focus()
				})
				return;
			}
			if (!password) {
				_alert('请设置新密码', function(ret, err) {
					$('#password').focus()
				})
				return;
			}
			if (!code) {
				_alert('验证码不能空', function(ret, err) {
					$('#code').focus()
				})
				return;
			}
			_loading()
			_ajax('user/resetpassword', function(ret, err) {
				_loadingCloes();
				if (ret.status) {
					_uot()
					if (_user) {
						_alert(ret.msg, function(ret) {
							_hone()
						})
					} else {
						_alert(ret.msg, function(ret) {
							_close()
						})
					}
				} else {
					_msg(ret.err)
				}
			}, {
				username: username,
				password: password,
				smscode: code
			})
		})
		$('#sendVerify').click(function() {
			var mobileVal = $('#mobile input').val();
			if (!mobileVal) {
				_alert('请输入手机号码', function(ret, err) {
					$('#username').focus()
				})
				return false;
			}
			if (!_isMobile(mobileVal)) {
				_alert('请输入正确手机号码', function(ret, err) {
					$('#username').focus()
				})
				return;
			}
			var status = $('#sendVerify').attr('status');
			if (status != 1) {
				return;
			}
			_loading();
			_ajax('user/get_reset_sms_code', function(ret, err) {
				if (ret.status) {
					$("#sendVerify").html('<span id="GetVerify">120</span>S');
					times = 119;
					isinerval = setInterval("CountDown()", 1000);
					setTimeout(function() {
						_alert(ret.msg)
						$('#sendVerify').attr('status', '0');
					}, 500)
				} else {
					_alert(ret.msg)
				}
				_loadingCloes()
			}, {
				username: mobileVal,
				text: '找回密码'
			})
		})
	}
	var smsVerify

	function CountDown() {
		if (times < 1) {
			var sendVerify = $('#sendVerify');
			$(sendVerify).attr('onclick', 'getVerify()');
			$(sendVerify).attr('status', '1');
			$(sendVerify).html('重新获取');
			clearInterval(isinerval);
			return;
		}
		var getVerify = $('#GetVerify');
		$(getVerify).html('' + times + '');
		times--;
	}
</script>

</html>
